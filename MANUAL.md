# 兎ラギア 1103 シミュレーター 使用マニュアル

## 目次

1. [基本的な使い方](#基本的な使い方)
2. [デッキ入力の詳細](#デッキ入力の詳細)
3. [シミュレーション手順](#シミュレーション手順)
4. [各機能の詳細説明](#各機能の詳細説明)
5. [よくある操作パターン](#よくある操作パターン)
6. [トラブルシューティング](#トラブルシューティング)

---

## 基本的な使い方

### 起動

```bash
npm i && npm run dev
```

ブラウザで `http://localhost:5173` を開きます。

### 画面構成

- **左側**: デッキ入力・操作パネル
- **中央**: 手札・場・墓地・簡易行動
- **右側**: フェイズリング・割り込み管理・ログ

---

## デッキ入力の詳細

### 入力形式

テキストエリアに、1行1カード名で入力します。

#### 枚数指定の方法

以下の3つの形式に対応しています：

```
レスキューラビット x3
強欲で謙虚な壺 x3
奈落の落とし穴 3
```

- `カード名 x3` （×記号も可）
- `カード名 3` （数字のみ）
- `カード名` （枚数指定なしの場合は1枚として扱われます）

#### 入力例

```
聖なるバリアーミラーフォース-×1
奈落の落とし穴×2
強制脱出装置×3
次元幽閉×2
神の宣告×1
盗賊の七つ道具×3
神の警告×2
激流葬×1
王宮の弾圧×1
レスキューラビット x3
強欲で謙虚な壺 x3
```

### 自動保存

デッキ入力内容は自動的にブラウザのlocalStorageに保存されます。次回起動時に自動復元されます。

### 統計表示

デッキ入力後、画面上部に以下の統計が表示されます：

- **P(初手5に強謙≥1)**: 初手5枚に強欲で謙虚な壺が1枚以上含まれる確率
- **P(6枚に強謙≥1)**: 6枚ドロー時に強欲で謙虚な壺が1枚以上含まれる確率
- **P(初手5に罠≥1)**: 初手5枚に罠が1枚以上含まれる確率
- **P(初手5に罠≥2)**: 初手5枚に罠が2枚以上含まれる確率

※ 罠の判定はカード名に「罠」または「トラップ」が含まれる場合にカウントされます。

---

## シミュレーション手順

### 基本的な流れ

1. **デッキ入力**
   - テキストエリアにデッキリストを貼り付け
   - 合計枚数を確認

2. **シャッフル**
   - 「シャッフル」ボタンをクリック
   - シード付き乱数でシャッフル（再現可能）

3. **初手ドロー**
   - 「初手5枚ドロー」ボタンをクリック
   - 手札に5枚が追加されます

4. **先攻の場合**
   - 「先攻ドロー（+1）」ボタンをクリック
   - 手札が6枚になります

5. **ゲーム進行**
   - フェイズリングでフェイズを管理
   - 手札のカードをクリックして使用済み/公開を管理
   - 簡易行動ボタンで行動を記録

6. **強欲で謙虚な壺を使用**
   - 「強欲で謙虚な壺を使用」ボタンをクリック
   - そのターンは特殊召喚不可（ロック表示）

7. **ターン終了**
   - 「ターン終了」ボタンをクリック
   - 強謙ロックが自動解除されます

8. **ログ出力**
   - 右上のログパネルで「コピー」ボタンをクリック
   - Notionに貼り付け可能なMarkdown形式でコピーされます

---

## 各機能の詳細説明

### 1. シャッフル機能

- **シード付き乱数**: 日時をシードとして使用（再現可能）
- **再現性**: 同じシードで同じシャッフル結果が得られます
- **エクスポート/インポート**: シードも含めて状態を保存できます

### 2. ドロー機能

#### 初手5枚ドロー
- デッキから5枚をドロー
- 手札に追加されます

#### 先攻ドロー（+1）
- 先攻時の追加ドロー
- 手札に1枚追加されます

### 3. 手札管理

#### 左クリック
- **使用済み/未使用のトグル**
- 使用済みカードはグレー背景で表示
- ログに記録されません（視覚的な管理のみ）

#### 右クリック
- **公開/非公開のトグル**
- 公開カードは黄色背景で表示
- 相手に見せたカードを管理

### 4. 強欲で謙虚な壺（強謙）ロック

#### 1103ルール準拠
- 強欲で謙虚な壺を使用したターンは**特殊召喚不可**
- 「強欲で謙虚な壺を使用」ボタンをクリックすると：
  - ログに記録されます
  - 特殊召喚ボタンがロックされます（グレー表示）
  - 警告メッセージが表示されます

#### ロック解除
- **ターン終了**で自動解除
- 「ターン終了」ボタンをクリックすると：
  - ターン数が増加
  - フェイズがDP（ドローフェイズ）にリセット
  - 強謙ロックが解除されます

### 5. フェイズリング

#### フェイズ一覧
- **DP** (ドローフェイズ) - 緑
- **SP** (スタンバイフェイズ) - 緑
- **MP1** (メインフェイズ1) - 緑
- **BP** (バトルフェイズ) - 青
- **MP2** (メインフェイズ2) - 緑
- **EP** (エンドフェイズ) - 紫

#### 操作方法
- **「← 前」ボタン**: 前のフェイズに戻る
- **「次 →」ボタン**: 次のフェイズに進む
- 現在のフェイズはリング上で大きく表示され、カーソル（線）が指します

#### 視覚的表示
- リング上の各フェイズは色分けされています
- 現在のフェイズは中央のボックスに大きく表示
- アニメーションでスムーズに遷移します

### 6. 割り込み管理

#### 対面デッキ選択
以下のデッキタイプから選択できます：
- **六武** (Six Samurai)
- **カラクリ** (Karakuri)
- **ジャンド** (Junk Doppel)
- **HERO**
- **ミラー** (Mirror Match)

#### 割り込み候補
選択したデッキタイプに応じて、代表的な割り込みカードが表示されます：
- チェックボックスで「相手がこれを持っていた」を管理
- 例：神の警告、奈落の落とし穴、次元幽閉など

#### 使い方
1. 対面デッキを選択
2. 相手が使用した割り込みカードにチェックを入れる
3. ログには記録されません（視覚的な管理のみ）

### 7. 簡易行動ボタン

以下の行動をワンクリックでログに記録できます：

- **通常召喚** (緑)
- **特殊召喚** (赤) - 強謙ロック中は使用不可
- **魔法発動** (青)
- **罠発動** (紫)
- **攻撃宣言** (橙)
- **ダメージステップ** (橙)

各ボタンをクリックすると、現在のターン・フェイズと共にログに記録されます。

### 8. ログ機能

#### Notion用Markdown形式
以下の情報が含まれます：

```
# デュエルログ

**開始ターン**: 1
**現在フェイズ**: MP1

## 行動ログ

### T1 - DP
- デッキをシャッフル
- 初手5枚をドロー

### T1 - MP1
- 強欲で謙虚な壺を使用（このターンは特殊召喚不可）
- 通常召喚

## 現在の状態
- **手札**: 4枚
  - レスキューラビット [使用済み]
  - 強欲で謙虚な壺
  ...
```

#### コピー機能
- 「コピー」ボタンをクリック
- クリップボードにMarkdown形式でコピーされます
- Notionに直接貼り付け可能

### 9. エクスポート/インポート

#### エクスポート
- 「エクスポート」ボタンをクリック
- JSONファイルがダウンロードされます
- 以下の情報が保存されます：
  - デッキ状態
  - 手札
  - 場
  - 墓地
  - 現在のフェイズ
  - ターン数
  - 強謙ロック状態
  - ログ
  - シード

#### インポート
- 「インポート」ボタンをクリック
- 保存したJSONファイルを選択
- 状態が復元されます

---

## よくある操作パターン

### パターン1: 初手シミュレーション

1. デッキを入力
2. 「シャッフル」をクリック
3. 「初手5枚ドロー」をクリック
4. 手札を確認
5. 統計と比較（画面上部の確率表示）

### パターン2: 強謙使用ターン

1. ゲーム開始（シャッフル→初手ドロー）
2. フェイズをMP1に変更
3. 「強欲で謙虚な壺を使用」をクリック
4. 特殊召喚ボタンがロックされることを確認
5. 通常召喚のみ可能
6. ターン終了でロック解除

### パターン3: 完全なターン進行

1. **DP**: フェイズリングでDPに設定
2. **SP**: 「次 →」でSPに進む
3. **MP1**: 
   - カードを発動（簡易行動ボタン）
   - 手札をクリックして使用済みに
4. **BP**: 
   - 「攻撃宣言」をクリック
   - 「ダメージステップ」をクリック
5. **MP2**: 追加行動があれば記録
6. **EP**: 「ターン終了」をクリック

### パターン4: ログ記録とNotion共有

1. ゲーム進行中、各行動を記録
2. ターン終了時に右上のログパネルを確認
3. 「コピー」ボタンをクリック
4. Notionに貼り付け
5. 必要に応じて編集

---

## トラブルシューティング

### Q: デッキ入力が反映されない

**A**: 以下の点を確認してください：
- カード名と枚数の間にスペースがあるか
- 枚数指定の形式が正しいか（`x3` または `3`）
- テキストエリアに何か入力されているか

### Q: シャッフルしても同じ結果になる

**A**: これは正常な動作です。シード付き乱数を使用しているため、同じシードでは同じ結果になります。新しいシードでシャッフルするには、少し時間を置いてから再度「シャッフル」をクリックしてください。

### Q: 強謙ロックが解除されない

**A**: 「ターン終了」ボタンをクリックしてください。強謙ロックはターン終了時に自動解除されます。

### Q: ログが表示されない

**A**: 何か行動を記録してください。ログは以下の操作で記録されます：
- シャッフル
- ドロー
- 強謙使用
- 簡易行動ボタン（通常召喚、特殊召喚など）

### Q: エクスポートしたファイルが読み込めない

**A**: 以下の点を確認してください：
- ファイルがJSON形式であること
- ファイルが破損していないこと
- このアプリでエクスポートしたファイルであること

### Q: 統計が正しく表示されない

**A**: 以下の点を確認してください：
- デッキ枚数が正しく入力されているか
- 強謙のカード名に「強欲で謙虚な壺」が含まれているか
- 罠のカード名に「罠」または「トラップ」が含まれているか

---

## 補足情報

### キーボードショートカット

現在は実装されていませんが、将来的に追加予定です。

### ブラウザ対応

- Chrome/Edge（推奨）
- Firefox
- Safari

### データ保存

- デッキ入力: localStorage（ブラウザに保存）
- ゲーム状態: エクスポート機能でJSONファイルとして保存

### 注意事項

- ページをリロードすると、エクスポートしていないゲーム状態は失われます
- デッキ入力は自動保存されますが、ゲーム状態は手動でエクスポートが必要です
- 強謙ロックはターン終了まで継続します（1103ルール準拠）

---

## 更新履歴

- v1.0.0: 初回リリース
  - デッキ入力・シャッフル・ドロー機能
  - 強謙ロック機能
  - フェイズリング
  - 割り込み管理
  - Notion用ログ生成
  - エクスポート/インポート機能
