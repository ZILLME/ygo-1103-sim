# 兎ラギア 1103 シミュレーター

遊戯王TCGの1103（マスタールール2）用ローカルWebアプリケーション。兎ラギアの高速スパー用に最適化されています。

## 機能

- **デッキ入力**: テキスト貼り付けでデッキを登録（1行1カード名、枚数指定対応）
- **相手デッキ入力**: 相手デッキを入力すると、確率的に自動割り込みが発生
- **シャッフル＆ドロー**: シード付き乱数による再現可能なシャッフル
- **強謙ロック**: 強欲で謙虚な壺使用後、そのターンは特殊召喚不可（1103ルール準拠）
- **フェイズ自動進行**: 行動に応じて自動的にフェイズが遷移
- **自動割り込みシステム**: 相手デッキ構成から確率的に妨害を判定
- **フェイズリング**: フェイズリング（カーソル）による視覚的なフェイズ管理
- **Notion用ログ**: Markdown形式のログ生成とコピー機能（相手の反応も記録）
- **エクスポート/インポート**: ゲーム状態の保存と読み込み

## 起動手順

### ローカル開発

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev
```

ブラウザで `http://localhost:5173` を開いてください。

### ビルド

```bash
# 本番ビルド
npm run build

# ビルド結果のプレビュー（任意）
npm run preview
```

ビルド結果は `dist/` ディレクトリに出力されます。

## Vercelへのデプロイ

このプロジェクトはVercelに即デプロイ可能な状態になっています。

### 方法1: Vercel Dashboard（GUI）

1. [Vercel](https://vercel.com)にログイン
2. 「Add New Project」をクリック
3. GitHubリポジトリを選択（またはGitHubと連携）
4. プロジェクトをインポート
5. 設定を確認：
   - **Framework Preset**: Vite
   - **Build Command**: `npm run build`（自動検出）
   - **Output Directory**: `dist`（自動検出）
   - **Install Command**: `npm install`（自動検出）
6. 「Deploy」をクリック

### 方法2: Vercel CLI

```bash
# Vercel CLIをインストール（初回のみ）
npm i -g vercel

# プロジェクトルートで実行
vercel

# 本番環境にデプロイ
vercel --prod
```

### デプロイ後の動作

- GitHubにpushすると自動的にデプロイされます（Git連携時）
- すべての機能がローカルと同じように動作します
- localStorageはブラウザ側で動作するため、サーバー依存なし

### 注意事項

- **Node.jsバージョン**: Vercelは自動的に適切なバージョンを選択しますが、`package.json`に`engines`フィールドを追加することも可能です
- **環境変数**: 現在は不要ですが、必要に応じてVercel Dashboardで設定できます
- **ビルド時間**: 初回デプロイは依存関係のインストールを含むため、数分かかる場合があります

## 使い方

詳細な使い方は **[MANUAL.md](./MANUAL.md)** を参照してください。

### クイックスタート

1. **自分のデッキ入力**: テキストエリアにカード名を1行ずつ入力
   ```
   レスキューラビット x3
   強欲で謙虚な壺 x3
   奈落の落とし穴 3
   ```

2. **相手デッキ入力**（オプション）: 相手デッキを入力すると自動割り込みが有効化
   ```
   神の警告 x2
   奈落の落とし穴 x2
   次元幽閉 x2
   ```

3. **シャッフル**: 「シャッフル」ボタンをクリック

4. **初手ドロー**: 「初手5枚ドロー」ボタンをクリック（自動でSPへ遷移）

5. **先攻の場合**: 「先攻ドロー（+1）」ボタンをクリック

6. **ゲーム進行**: 
   - 簡易行動ボタンで行動を記録
   - 行動に応じて自動的にフェイズが遷移
   - 相手デッキが入力されている場合、確率的に自動割り込みが発生

7. **強謙使用**: 「強欲で謙虚な壺を使用」ボタンで使用（そのターンは特殊召喚不可）

8. **ログ出力**: 右上のログパネルで「コピー」ボタンをクリックしてNotionに貼り付け

### ドラッグ&ドロップ操作

**カードをドラッグ&ドロップで移動できます**

- **ドラッグ**: カードをクリック&ドラッグ
- **ドロップ先**: 
  - 手札（Hand）
  - モンスターゾーン（MZ1-5）
  - 魔法罠ゾーン（ST1-5）
  - 墓地（Grave）
  - 除外（Banish）
  - デッキトップ/ボトム
- **移動理由選択**: ドロップ後にポップアップで理由を選択（通常召喚/特殊召喚/セット/発動/破壊/除外/バウンス/コスト/解決/移動）
- **ログ記録**: すべての移動が自動的にNotionログに記録されます

**自分と相手の両方の盤面で操作可能**
- 自分の盤面: 手札・場・墓地・除外すべて表示
- 相手の盤面: 学習モードなら手札も表示、本番モードなら手札は枚数のみ

### 主要機能

- **デッキ管理**: テキスト入力、枚数解析、自動保存
- **相手デッキ解析**: 相手デッキを入力すると、妨害カテゴリを自動分類
- **自動割り込みシステム**: 超幾何分布に基づいて確率的に妨害を判定
- **フェイズ自動進行**: 行動に応じて自動的にフェイズが遷移（DP→SP→MP1→BP→MP2→EP）
- **強謙ロック**: 1103ルール準拠（使用ターンは特殊召喚不可）
- **フェイズリング**: 視覚的なフェイズ管理
- **Notion用ログ**: Markdown形式のログ生成とコピー機能（相手の反応も記録）
- **エクスポート/インポート**: ゲーム状態の保存と読み込み

### 新機能：自動割り込みシステム

相手デッキを入力すると、以下のカテゴリに自動分類され、確率的に妨害が発生します：

- **通常召喚メタ**: 神の警告、奈落の落とし穴など
- **特殊召喚メタ**: 昇天の黒角笛、神の警告など
- **効果無効**: エフェクト・ヴェーラー、禁じられた聖杯など
- **戦闘メタ**: 次元幽閉、ミラーフォースなど
- **魔法罠メタ**: サイクロン、砂塵の大竜巻など

行動ボタンを押すと、現在のフェイズと行動タイプに応じて、適切なカテゴリから確率的に妨害が判定されます。妨害が発生した場合は、ポップアップで通知され、ログに自動記録されます。

## 技術スタック

- React 18
- Vite
- TypeScript
- シード付き乱数生成（Xorshift32）
- dnd-kit（ドラッグ&ドロップ）

## デプロイ

### Vercelへのデプロイ

このプロジェクトはVercelに即デプロイ可能です。

#### 前提条件

- Node.js 18以上
- npm 9以上

#### デプロイ方法

**方法1: Vercel Dashboard（推奨）**

1. [Vercel](https://vercel.com)にログイン
2. 「Add New Project」をクリック
3. GitHubリポジトリを選択（またはGitHubと連携）
4. プロジェクトをインポート
5. 設定を確認（自動検出される）：
   - **Framework Preset**: Vite
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
   - **Install Command**: `npm install`
6. 「Deploy」をクリック

**方法2: Vercel CLI**

```bash
# Vercel CLIをインストール（初回のみ）
npm i -g vercel

# プロジェクトルートで実行
vercel

# 本番環境にデプロイ
vercel --prod
```

#### 自動デプロイ

GitHubリポジトリと連携している場合、`main`ブランチ（または指定したブランチ）にpushすると自動的にデプロイされます。

#### デプロイ後の動作

- すべての機能がローカルと同じように動作します
- localStorageはブラウザ側で動作するため、サーバー依存なし
- SSR不要（完全なクライアントサイドアプリケーション）

#### トラブルシューティング

- **ビルドエラー**: `npm run build`がローカルで通ることを確認してください
- **環境変数**: 現在は不要ですが、必要に応じてVercel Dashboardで設定できます
- **Node.jsバージョン**: `package.json`の`engines`フィールドで指定されています

## 注意事項

- 強欲で謙虚な壺を使用したターンは、特殊召喚ボタンがロックされます
- ターン終了時に強謙ロックは自動解除されます
- デッキ入力は自動的にlocalStorageに保存されます

## ライセンス

MIT
